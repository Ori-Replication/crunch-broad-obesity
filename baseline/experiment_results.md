# Baseline Linear Model 实验报告

## 模型描述

实现了论文中描述的基线线性模型：Y ≈ GWP^T + b

### 模型组件
- **G (Gene Embeddings)**: 通过训练集的PCA得到，维度为 (n_genes × K)，K=10
- **P (Perturbation Embeddings)**: 对于单基因扰动，直接取G矩阵中对应基因的行，维度为 (n_perturbations × K)
- **W (Weight Matrix)**: 通过岭回归求解，维度为 (K × K)
- **b (Intercept)**: 训练数据的行均值，维度为 (n_genes,)

### 超参数
- K = 10 (PCA主成分数量)
- λ = 0.1 (岭回归正则化系数)

## 实验设置

### 数据
- 数据文件: `data/original_data/default/obesity_challenge_1.h5ad`
- 数据形状: (88202 cells, 21592 genes)
- 扰动数量: 122个单基因扰动（排除NC对照组）

### 交叉验证
- 方法: 5折交叉验证
- 划分方式: 按扰动基因划分（确保测试集泄露）
- 随机种子: 42

### 评估指标
1. **L2距离**: 
   - 表达值的L2距离：预测表达矩阵与真实表达矩阵之间的均方根误差
   - Delta的L2距离：预测Delta与真实Delta之间的均方根误差
2. **Pearson Delta**: 预测Delta与真实Delta之间的Pearson相关系数
   - Delta = 扰动表达 - 扰动均值（perturbed_centroid）
   - 这是竞赛使用的核心评估指标

## 实验结果

### 五折交叉验证结果

| Fold | Train Perturbations | Test Perturbations | L2 Distance (expr) | L2 Distance (delta) | Pearson Delta |
|------|---------------------|-------------------|---------------------|---------------------|---------------|
| 1    | 97                  | 25                | 0.0582              | 0.0582              | -0.0175       |
| 2    | 97                  | 25                | 0.0476              | 0.0476              | -0.1521       |
| 3    | 98                  | 24                | 0.0575              | 0.0575              | 0.0180        |
| 4    | 98                  | 24                | 0.0563              | 0.0563              | -0.1158       |
| 5    | 98                  | 24                | 0.0512              | 0.0512              | 0.0512        |

### 汇总统计

- **平均L2距离（表达值）**: 0.0542 ± 0.0041
- **平均L2距离（Delta）**: 0.0542 ± 0.0041
- **平均Pearson Delta**: -0.0432 ± 0.0780

## 结果分析

### L2距离
- L2距离相对较小（约0.05），说明模型在预测表达值的绝对大小方面表现尚可
- 这可能是因为数据已经标准化，且模型学习了基本的表达模式

### Pearson Delta
- **Pearson Delta为负值（平均-0.0432）**，说明模型在预测扰动效应（Delta）方面表现不佳
- **Delta = 扰动表达 - 扰动均值**，Pearson Delta衡量的是预测Delta与真实Delta之间的相关性
- 这可能的原因：
  1. **未知单扰动场景**：测试集中的扰动基因在训练集中没有出现过，模型缺乏直接的学习样本
  2. **模型简单性**：Baseline线性模型可能无法捕捉复杂的基因调控关系和非线性效应
  3. **嵌入质量**：基于所有扰动伪批量数据的PCA可能不够区分不同扰动的特异性效应
  4. **数据规模**：训练数据相对有限（122个扰动），可能不足以学习稳健的扰动-效应映射

### L2距离
- L2距离相对较小（约0.05），说明模型在预测表达值的绝对大小方面表现尚可
- 这可能是因为数据已经标准化，且模型学习了基本的表达模式
- 但L2距离小不代表Pearson Delta高，因为Pearson Delta关注的是**扰动效应的模式**，而不仅仅是绝对大小

### 模型特点
- **优点**: 
  - 计算速度快，不需要GPU
  - 参数少，不容易过拟合
  - 在预测平均表达方面有一定能力
  
- **局限性**:
  - 对于未知扰动的预测能力有限
  - 无法捕捉复杂的非线性关系
  - 对扰动特异性效应的预测较差

## 改进方向

1. **特征工程**: 
   - 使用更丰富的基因特征（如共表达网络、通路信息等）
   - 考虑基因之间的相互作用

2. **模型改进**:
   - 增加模型复杂度（如增加K值）
   - 使用非线性模型
   - 考虑多扰动场景

3. **数据利用**:
   - 使用外部数据（如基因功能注释、蛋白质相互作用网络等）
   - 预训练基因嵌入

## 文件说明

- `src/baseline_linear_model.py`: 模型实现代码
- `baseline_cv_results.csv`: 交叉验证结果（CSV格式）
