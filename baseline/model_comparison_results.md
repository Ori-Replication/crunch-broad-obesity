# 模型对比实验结果

## 实验设置

- **数据**: `obesity_challenge_1.h5ad` (88202 cells, 21592 genes, 122 perturbations)
- **交叉验证**: 5折交叉验证，按扰动基因划分
- **评估指标**: L2距离（Delta）和Pearson Delta

## 模型1: 简单线性模型 (SimpleLinearModel)

### 模型架构
- **基因嵌入**: 使用控制组（NC）细胞的SVD，n_components=50
- **映射**: gene_embedding → delta (通过岭回归，alpha=0.1)
- **预测**: Y_pred = control_mean + delta_pred

### 实验结果

| Fold | L2 Distance (delta) | Pearson Delta |
|------|---------------------|---------------|
| 1    | 0.0571              | -0.0288       |
| 2    | 0.0437              | -0.0502       |
| 3    | 0.0568              | -0.0853       |
| 4    | 0.0510              | 0.0074        |
| 5    | 0.0489              | -0.0229       |

**汇总统计**:
- **平均L2距离（Delta）**: 0.0515 ± 0.0050
- **平均Pearson Delta**: -0.0360 ± 0.0308

## 模型2: 双线性模型 (BaselineLinearModel)

### 模型架构
- **基因嵌入**: 使用所有扰动伪批量数据的PCA，K=50
- **模型公式**: Y ≈ GWP^T + b
- **映射**: 双线性映射（G矩阵 × W矩阵 × P矩阵转置）

### 实验结果（K=50）

| Fold | L2 Distance (delta) | Pearson Delta |
|------|---------------------|---------------|
| 1    | 0.0582              | -0.0175       |
| 2    | 0.0476              | -0.1521       |
| 3    | 0.0575              | 0.0180        |
| 4    | 0.0563              | -0.1158       |
| 5    | 0.0512              | 0.0512        |

**汇总统计**:
- **平均L2距离（Delta）**: 0.0542 ± 0.0041
- **平均Pearson Delta**: -0.0432 ± 0.0780

## 对比分析

### L2距离
- **简单线性模型**: 0.0515 ± 0.0050
- **双线性模型**: 0.0542 ± 0.0041
- **结论**: 简单线性模型略好（约5%提升）

### Pearson Delta
- **简单线性模型**: -0.0360 ± 0.0308
- **双线性模型**: -0.0432 ± 0.0780
- **结论**: 简单线性模型略好，且方差更小（更稳定）

### 模型复杂度
- **简单线性模型**: 
  - 参数数量: n_components × n_genes = 50 × 21592 ≈ 1.08M
  - 训练速度: 快（单次SVD + 岭回归）
  
- **双线性模型**:
  - 参数数量: K × K = 50 × 50 = 2500（但需要G和P矩阵）
  - 训练速度: 中等（PCA + 矩阵运算）

### 关键差异

1. **基因嵌入数据源**:
   - 简单线性模型: 仅使用NC细胞（更稳定，代表正常状态）
   - 双线性模型: 使用所有扰动数据（可能包含更多信息，但也更嘈杂）

2. **模型结构**:
   - 简单线性模型: 直接学习 gene_embedding → delta 的映射
   - 双线性模型: 通过双线性结构学习更复杂的交互

3. **预测方式**:
   - 两者都预测delta，然后计算Pearson Delta
   - 简单线性模型更直接，双线性模型理论上表达能力更强

## 结论

**简单线性模型表现略好**，可能的原因：
1. 使用NC细胞构建基因嵌入更稳定，代表正常状态下的基因关系
2. 直接学习delta映射，避免了双线性结构的复杂性
3. 参数更少，不容易过拟合

**建议**:
- 对于baseline，简单线性模型是更好的选择
- 可以尝试调整超参数（n_components, lambda_reg）进一步优化
- 考虑使用余弦相似度损失（如main.py）可能进一步提升Pearson Delta
